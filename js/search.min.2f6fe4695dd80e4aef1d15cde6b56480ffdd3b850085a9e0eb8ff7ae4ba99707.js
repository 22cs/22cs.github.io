document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("search-form"),n=document.getElementById("search-input"),e=document.getElementById("search-results");if(!s||!n||!e)return;let o=[];fetch("/index.json").then(e=>e.json()).then(e=>{o=e}).catch(e=>{console.error("加载搜索索引出错:",e)}),s.addEventListener("submit",function(e){e.preventDefault(),i()}),n.addEventListener("input",i);function i(){const s=n.value.trim().toLowerCase();if(!s){e.innerHTML="";return}const i=o.filter(e=>{const n=t(e.title.toLowerCase(),s),o=t(e.content.toLowerCase(),s);return n>.3||o>.1});i.sort((e,n)=>{const o=t(e.title.toLowerCase(),s),i=t(n.title.toLowerCase(),s);return i-o}),a(i)}function a(t){if(t.length===0){e.innerHTML="<p>未找到结果</p>";return}let n=`<p>找到 ${t.length} 条结果</p><ul>`;t.forEach(e=>{n+=`
            <li>
                <a href="${e.permalink}">${e.title}</a>
                <span class="search-date">${e.date}</span>
            </li>`}),n+="</ul>",e.innerHTML=n}function t(e,t){if(!t)return 0;let s=0,n=0,o=-1,i=0;for(let i=0;i<e.length&&n<t.length;i++)if(e[i]===t[n]){n++;const e=o>=0?i-o:0;e<=1?s+=.7:s+=.1,o=i}return n===t.length?s/(t.length*.7):0}})